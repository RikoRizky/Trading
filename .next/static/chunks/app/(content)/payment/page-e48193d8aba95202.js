(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{8302:function(e,t,n){Promise.resolve().then(n.bind(n,222))},222:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),a=n(2265),o=n(4033),i=n(1122),s=n(9186);let l=a.forwardRef(function({title:e,titleId:t,...n},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});function c(){let[e,t]=(0,a.useState)(!1),[n,c]=(0,a.useState)("pending"),u=(0,o.useRouter)(),d=(0,o.useSearchParams)(),{user:m}=(0,i.useAuth)(),h=d.get("plan"),f={"1month":{name:"1 Month",duration:"30 days",price:5e4},"3months":{name:"3 Months",duration:"90 days",price:12e4},"1year":{name:"1 Year",duration:"365 days",price:4e5}};(0,a.useEffect)(()=>{let e=document.createElement("script");return e.src="https://app.sandbox.midtrans.com/snap/snap.js",e.setAttribute("data-client-key","Mid-client-GOvhF4492RPMa48O"),document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]);let p=async()=>{if(h&&m){t(!0);try{var e;let t=f[h],n=await fetch("/api/midtrans/route",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t.price,plan:h,name:(null===(e=m.user_metadata)||void 0===e?void 0:e.name)||m.email,email:m.email,description:"Upgrade Premium - ".concat(t.name)})}),r=await n.json();r.token?window.snap?window.snap.pay(r.token,{onSuccess:function(e){console.log("Payment success:",e),c("success"),setTimeout(()=>u.push("/dashboard"),3e3)},onPending:function(e){console.log("Waiting for payment:",e)},onError:function(e){console.error("Payment failed:",e),c("failed")},onClose:function(){alert("Payment popup closed without finishing transaction")}}):alert("Midtrans not loaded yet. Please wait a moment..."):alert("Failed to create transaction")}catch(e){console.error("Payment error:",e),c("failed")}finally{t(!1)}}},g=h?f[h]:null;return g?(0,r.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Checkout Premium Plan"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-4",children:[g.name," â€” Rp ",g.price.toLocaleString()]}),"success"===n?(0,r.jsxs)("div",{className:"text-center text-green-600",children:[(0,r.jsx)(s.Z,{className:"h-16 w-16 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-lg font-semibold",children:"Payment Successful!"}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"Redirecting to dashboard..."})]}):"failed"===n?(0,r.jsxs)("div",{className:"text-center text-red-600",children:[(0,r.jsx)(l,{className:"h-16 w-16 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-lg font-semibold",children:"Payment Failed"}),(0,r.jsx)("button",{onClick:p,className:"mt-4 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition",children:"Try Again"})]}):(0,r.jsx)("button",{onClick:p,disabled:e,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg transition w-full",children:e?"Processing...":"Pay Now"})]})}):(0,r.jsx)("p",{className:"text-center mt-20",children:"Invalid Plan"})}},1122:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthProvider:function(){return s},useAuth:function(){return l}});var r=n(7437),a=n(2265),o=n(1097);let i=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[n,s]=(0,a.useState)(null),[l,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),m=(0,o.e)();(0,a.useEffect)(()=>{let e=async e=>{try{let{data:t,error:n}=await m.from("profiles").select("*").eq("id",e).single();n?console.error("Error fetching profile:",n):c(t)}catch(e){console.error("Error in fetchProfile:",e)}};(async()=>{try{let{data:{session:t},error:n}=await m.auth.getSession();n?console.error("Error getting session:",n):(null==t?void 0:t.user)&&(s(t.user),await e(t.user.id))}catch(e){console.error("Error in getInitialSession:",e)}finally{d(!1)}})();let{data:{subscription:t}}=m.auth.onAuthStateChange(async(t,n)=>{"SIGNED_IN"===t&&(null==n?void 0:n.user)?(s(n.user),await e(n.user.id)):"SIGNED_OUT"===t&&(s(null),c(null)),d(!1)});return()=>{t.unsubscribe()}},[m.auth]);let h=async()=>{try{let{error:e}=await m.auth.signOut();e&&console.error("Error signing out:",e)}catch(e){console.error("Error in signOut:",e)}},f=async()=>{if(n)try{let{data:e,error:t}=await m.from("profiles").select("*").eq("id",n.id).single();t?console.error("Error refreshing profile:",t):c(e)}catch(e){console.error("Error in refreshProfile:",e)}};return(0,r.jsx)(i.Provider,{value:{user:n,profile:l,loading:u,signOut:h,refreshProfile:f},children:t})}function l(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1097:function(e,t,n){"use strict";n.d(t,{e:function(){return a}});var r=n(3082);let a=()=>(0,r.createClientComponentClient)()},4033:function(e,t,n){e.exports=n(5313)},9186:function(e,t,n){"use strict";var r=n(2265);let a=r.forwardRef(function({title:e,titleId:t,...n},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},n),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});t.Z=a}},function(e){e.O(0,[872,82,971,938,744],function(){return e(e.s=8302)}),_N_E=e.O()}]);