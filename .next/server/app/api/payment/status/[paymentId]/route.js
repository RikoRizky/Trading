"use strict";(()=>{var e={};e.id=6524,e.ids=[6524],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},57147:e=>{e.exports=require("fs")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},89025:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var s={};r.r(s),r.d(s,{GET:()=>d,runtime:()=>p});var a=r(95419),n=r(69108),i=r(99678),o=r(78070),u=r(42509);let p="nodejs";async function d(e,{params:t}){try{let{paymentId:e}=t;if(!e)return o.Z.json({success:!1,error:"Payment ID required"},{status:400});let s=(0,u.lx)(),{data:a,error:n}=await s.from("payments").select("*").eq("id",e).single();if(n||!a)return o.Z.json({success:!1,error:"Payment not found"},{status:404});let i=new Date,p=new Date(a.expires_at);if(i>p&&"pending"===a.status)return await s.from("payments").update({status:"expired"}).eq("id",e),o.Z.json({success:!0,status:"expired"});if("pending"===a.status&&"midtrans"===a.payment_method)try{let{verifyPayment:t}=await Promise.all([r.e(7670),r.e(2745)]).then(r.bind(r,12745)),n=await t(e,"midtrans");if("paid"===n.status){await s.from("payments").update({status:"paid",paid_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e);let t=function(e){if(e.includes("1 Month")||e.includes("30 days"));else if(e.includes("3 Months")||e.includes("90 days"))return 90;else if(e.includes("1 Year")||e.includes("365 days"))return 365;return 30}(a.description),r=new Date;r.setDate(r.getDate()+t);let n=function(e){if(e.includes("1 Month")||e.includes("30 days"));else if(e.includes("3 Months")||e.includes("90 days"))return"3months";else if(e.includes("1 Year")||e.includes("365 days"))return"1year";return"1month"}(a.description);return await s.from("profiles").update({membership_type:"premium",subscription_start:new Date().toISOString(),subscription_end:r.toISOString(),subscription_plan:n,updated_at:new Date().toISOString()}).eq("id",a.user_id),o.Z.json({success:!0,status:"paid"})}"failed"===n.status&&await s.from("payments").update({status:"failed",updated_at:new Date().toISOString()}).eq("id",e)}catch(e){console.error("Error verifying payment:",e)}else if("pending"===a.status&&"qris"===a.payment_method&&Math.random()>.7){await s.from("payments").update({status:"paid",paid_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e);let t=new Date;return t.setDate(t.getDate()+30),await s.from("profiles").update({membership_type:"premium",subscription_start:new Date().toISOString(),subscription_end:t.toISOString(),updated_at:new Date().toISOString()}).eq("id",a.user_id),o.Z.json({success:!0,status:"paid"})}return o.Z.json({success:!0,status:a.status})}catch(e){return console.error("Payment status check error:",e),o.Z.json({success:!1,error:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payment/status/[paymentId]/route",pathname:"/api/payment/status/[paymentId]",filename:"route",bundlePath:"app/api/payment/status/[paymentId]/route"},resolvedPagePath:"/Users/rikorizky/Documents/Aplikasi Trading/Trading/src/app/api/payment/status/[paymentId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:y,headerHooks:f,staticGenerationBailout:g}=c,w="/api/payment/status/[paymentId]/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},42509:(e,t,r)=>{r.d(t,{VL:()=>i,XU:()=>u,lx:()=>n});var s=r(57699),a=r(32455);let n=()=>{let e=(0,a.cookies)();return(0,s.createServerComponentClient)({cookies:()=>e})};async function i(){let e=n(),{data:{user:t},error:r}=await e.auth.getUser();return r?(console.error("Error getting user:",r),null):t}async function o(e){let t=n(),{data:r,error:s}=await t.from("profiles").select("*").eq("id",e).single();return s?(console.error("Error getting profile:",s),null):r}async function u(e){if(!e)return!1;let t=await o(e);return!!t&&"premium"===t.membership_type&&(!t.membership_expires_at||new Date(t.membership_expires_at)>new Date)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[6225,6349,6206],()=>r(89025));module.exports=s})();