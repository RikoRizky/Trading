"use strict";(()=>{var e={};e.id=8941,e.ids=[8941],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},34914:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>b,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var s={};t.r(s),t.d(s,{POST:()=>c,runtime:()=>p});var i=t(95419),n=t(69108),o=t(99678),a=t(78070),u=t(42509);let p="nodejs";async function c(e){try{let e=(0,u.lx)(),{data:r,error:t}=await e.from("profiles").select("id, full_name, email").eq("membership_type","premium").not("subscription_end","is",null).lt("subscription_end",new Date().toISOString());if(t)return console.error("Error fetching expired subscriptions:",t),a.Z.json({success:!1,error:"Failed to fetch expired subscriptions"},{status:500});if(r&&r.length>0){let{error:t}=await e.from("profiles").update({membership_type:"free",subscription_start:null,subscription_end:null,updated_at:new Date().toISOString()}).eq("membership_type","premium").not("subscription_end","is",null).lt("subscription_end",new Date().toISOString());if(t)return console.error("Error updating expired subscriptions:",t),a.Z.json({success:!1,error:"Failed to update expired subscriptions"},{status:500});console.log(`Updated ${r.length} expired subscriptions to free`)}return a.Z.json({success:!0,expiredCount:r?.length||0,message:`Checked and updated ${r?.length||0} expired subscriptions`})}catch(e){return console.error("Subscription expiry check error:",e),a.Z.json({success:!1,error:"Internal server error"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/subscription/check-expiry/route",pathname:"/api/subscription/check-expiry",filename:"route",bundlePath:"app/api/subscription/check-expiry/route"},resolvedPagePath:"/Users/rikorizky/Documents/Aplikasi Trading/Trading/src/app/api/subscription/check-expiry/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:x,headerHooks:h,staticGenerationBailout:g}=l,b="/api/subscription/check-expiry/route";function f(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},42509:(e,r,t)=>{t.d(r,{VL:()=>o,XU:()=>u,lx:()=>n});var s=t(57699),i=t(32455);let n=()=>{let e=(0,i.cookies)();return(0,s.createServerComponentClient)({cookies:()=>e})};async function o(){let e=n(),{data:{user:r},error:t}=await e.auth.getUser();return t?(console.error("Error getting user:",t),null):r}async function a(e){let r=n(),{data:t,error:s}=await r.from("profiles").select("*").eq("id",e).single();return s?(console.error("Error getting profile:",s),null):t}async function u(e){if(!e)return!1;let r=await a(e);return!!r&&"premium"===r.membership_type&&(!r.membership_expires_at||new Date(r.membership_expires_at)>new Date)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[6225,6349,6206],()=>t(34914));module.exports=s})();